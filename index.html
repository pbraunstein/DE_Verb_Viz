<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>German Verb Viz</title>
	<link href="http://fonts.googleapis.com/css?family=Merienda+One" rel="stylesheet" type="text/css">
	<link href="http://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet" type="text/css">
	<script type="text/javascript" src="libs/d3/d3.min.js"></script>
</head>
<style>
	.node {
		stroke: #fff;
		stroke-width: 1.5px;
	}

	.node text {
		  pointer-events: none;
  		  font: 30px Merienda;
	}

	.link {
		stroke: #999;
		stroke-opacity: .6;
	}
</style>
<body>
	Hello World!
	<script>
		var color = d3.scale.category20();
		var data;
		var width = 600;
		var height = 600;
		var svg = d3.select("body").append("svg")
					.attr("width", width)
					.attr("height", height)
		console.log("In Script");

		d3.json("data/data.json", function(error, json){
			if (error) return console.warn(error);
			data = json;
			vizIt();
		});

		function vizIt() {
			buildFDG(data[1]);
		}

		function buildFDG(preTree) {
			var fdg = d3.layout.force()
				.gravity(0.05)
				.distance(100)
				.charge(-1000)
				.size([width, height]);
			nodes = [];
			i = 1;

			// Create hub node
			nodes.push({"name":preTree.root, "group":i++})

			// Create all of the surrounding nodes
			preTree.childWords.forEach(function(word) {
				nodes.push({"name":word.verb, "group":i++});
			});

			links = [];
			// Create links
			for (i = 1; i < nodes.length; i++){
				var newLink = {"source":0, "target":i, "value":6}
				if (preTree.childWords[i - 1].separ == "y") {
					newLink.separ = true;
				} else {
					newLink.separ = false;
				}
				links.push(newLink);
			}
			
			fdg.nodes(nodes).links(links).linkDistance(function(thisLink){
				if (thisLink.separ) {
					return 200;}
				else {
					return 100;
				}
			  }).start();

			// draw lines for links
			var link = svg.selectAll(".link")
						  .data(links)
						  .enter().append("line")
						  .attr("class", "link")
						  .style("stroke-dasharray", function(d) {if (d.separ) {return 10} else {return 0}})
      					  .style("stroke-width", function(d) { if (d.separ) {return Math.sqrt(d.value);} else {return d.value}});

      		//draw circles for nodes
			var node = svg.selectAll(".node")
						  .data(nodes)
						  .enter().append("g")
						  .attr("class", "node")
						  .call(fdg.drag);
				node.append("circle")		  
						  .attr("r", 20)
						  .style("fill", function(d) { return color(d.group); })

		  	node.append("text")
		  		.attr("text-anchor", "middle")
		  		.attr("dy", ".35em")
		  		.style("fill", "gray")
		  		.style("stroke", "black")
		  		.text(function(d) {return d.name});

		  	fdg.on("tick", function() {
			    link.attr("x1", function(d) { return d.source.x; })
			        .attr("y1", function(d) { return d.source.y; })
			        .attr("x2", function(d) { return d.target.x; })
			        .attr("y2", function(d) { return d.target.y; });

			     node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
			});
		}

	</script>
</body>
</html>